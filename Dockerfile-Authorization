FROM microsoft/dotnet:latest

ENV ASPNETCORE_ENVIRONMENT docker

COPY SimpleIdentityServer/src /app

WORKDIR /app

RUN dotnet restore
RUN bash -c "cd SimpleIdentityServer.DataAccess.SqlServer && dotnet ef database update"

EXPOSE 5000

ENTRYPOINT ["dotnet", "run", "--project", "SimpleIdentityServer.Startup/project.json"]